<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 16 Text Cleaning | Introduction to R</title>
<meta name="author" content="Ethan Hurwitz">
<meta name="description" content="More often than not, when working with text responses or any sort of character data output, it will initially be very difficult to work with. This is the case both when dealing with qualitative...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="Chapter 16 Text Cleaning | Introduction to R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ethanhurwitz.github.io/intro-to-r/text-cleaning.html">
<meta property="og:description" content="More often than not, when working with text responses or any sort of character data output, it will initially be very difficult to work with. This is the case both when dealing with qualitative...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 16 Text Cleaning | Introduction to R">
<meta name="twitter:description" content="More often than not, when working with text responses or any sort of character data output, it will initially be very difficult to work with. This is the case both when dealing with qualitative...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introduction to R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Background</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="why-use-r.html"><span class="header-section-number">2</span> Why use R?</a></li>
<li><a class="" href="r-coding-basics.html"><span class="header-section-number">3</span> R Coding Basics</a></li>
<li><a class="" href="using-r-effectively.html"><span class="header-section-number">4</span> Using R Effectively</a></li>
<li><a class="" href="projects-and-organization.html"><span class="header-section-number">5</span> Projects and Organization</a></li>
<li class="book-part">Visualizations</li>
<li><a class="" href="intro-to-ggplot2.html"><span class="header-section-number">6</span> Intro to ggplot2</a></li>
<li><a class="" href="aesthetics.html"><span class="header-section-number">7</span> Aesthetics</a></li>
<li><a class="" href="different-geoms-and-when-to-use-them.html"><span class="header-section-number">8</span> Different Geoms and When To Use Them</a></li>
<li><a class="" href="customization.html"><span class="header-section-number">9</span> Customization</a></li>
<li><a class="" href="Color-Theory.html"><span class="header-section-number">10</span> Color Theory</a></li>
<li class="book-part">Data Manipulation</li>
<li><a class="" href="control-flow.html"><span class="header-section-number">11</span> Control Flow</a></li>
<li><a class="" href="tidy-data-and-tidyverse.html"><span class="header-section-number">12</span> Tidy Data and Tidyverse</a></li>
<li><a class="" href="basic-wrangling.html"><span class="header-section-number">13</span> Basic Wrangling</a></li>
<li><a class="" href="advanced-wrangling.html"><span class="header-section-number">14</span> Advanced Wrangling</a></li>
<li><a class="" href="summarizing-data.html"><span class="header-section-number">15</span> Summarizing Data</a></li>
<li><a class="active" href="text-cleaning.html"><span class="header-section-number">16</span> Text Cleaning</a></li>
<li><a class="" href="data-transformation.html"><span class="header-section-number">17</span> Data Transformation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="text-cleaning" class="section level1" number="16">
<h1>
<span class="header-section-number">16</span> Text Cleaning<a class="anchor" aria-label="anchor" href="#text-cleaning"><i class="fas fa-link"></i></a>
</h1>
<p>More often than not, when working with text responses or any sort of character data output, it will initially be very difficult to work with. This is the case both when dealing with qualitative data and sometimes even just from the output of your data collection means (Qualtrics, Googleforms, etc.). What follow are some common cleaning procedures.</p>
<div id="remove-text-from-strings" class="section level2" number="16.1">
<h2>
<span class="header-section-number">16.1</span> Remove Text From Strings<a class="anchor" aria-label="anchor" href="#remove-text-from-strings"><i class="fas fa-link"></i></a>
</h2>
<p>Say your data output included a “Response:” before each response. Obviously, you would want the variable to just contain the actual response values. You can use <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all()</a></code> to remove a specified pattern from a text response. Here, removing “Response:”.</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"Response:Apple Juice"</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "Response:Apple Juice"</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Response:"</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "Apple Juice"</span></span></code></pre></div>
</div>
<div id="escaping-special-characters" class="section level2" number="16.2">
<h2>
<span class="header-section-number">16.2</span> Escaping Special Characters<a class="anchor" aria-label="anchor" href="#escaping-special-characters"><i class="fas fa-link"></i></a>
</h2>
<p>In many programming languages, dealing with special characters is difficult. The language has trouble deciding if you are trying to <strong>use</strong> the character or just <em>refer</em> to it.</p>
<p>Consider the example below:</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">'{Response:"Apple Juice"}'</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "{Response:\"Apple Juice\"}"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'{'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in stri_replace_all_regex(string, pattern, fix_replacement(replacement), : Syntax error in regex pattern. (U_REGEX_RULE_SYNTAX, context=`{`)</span></span></code></pre></div>
<p>Instead, you have to do what is called “escaping” a special character. One way to do so in R is to wrap the character in brackets.</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">'{Response:"Apple Juice"}'</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "{Response:\"Apple Juice\"}"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'[{]'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Response:\"Apple Juice\"}"</span></span></code></pre></div>
<p>Now this raises the question of what do you do when you want to escape a bracket? You can do so with double forward slash.</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">'[Response:"Apple Juice"]'</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "[Response:\"Apple Juice\"]"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'\\['</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Response:\"Apple Juice\"]"</span></span></code></pre></div>
<p class="text-info">
<strong>Note: Double forward slash (\) can be used to escape any special character as well, not just brackets.</strong>
</p>
</div>
<div id="removing-multiple-strings-at-once" class="section level2" number="16.3">
<h2>
<span class="header-section-number">16.3</span> Removing Multiple Strings at Once<a class="anchor" aria-label="anchor" href="#removing-multiple-strings-at-once"><i class="fas fa-link"></i></a>
</h2>
<p>You can remove multiple strings at once by using <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> to include all the characters or strings you want removed.</p>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">'Response:{"Apple Juice"}'</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Response'</span>, <span class="st">'[:]'</span>, <span class="st">'[{]'</span>, <span class="st">'["]'</span>, <span class="st">'[}]'</span><span class="op">)</span>, </span>
<span>                        collapse<span class="op">=</span><span class="st">'|'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Apple Juice"</span></span></code></pre></div>
</div>
<div id="removing-the-first-instance" class="section level2" number="16.4">
<h2>
<span class="header-section-number">16.4</span> Removing the First Instance<a class="anchor" aria-label="anchor" href="#removing-the-first-instance"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes, you do not want EVERY instance of a string removed. In the example below, the string “Answer” is actually part of a participant’s response. This should not be removed!</p>
<div class="sourceCode" id="cb343"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">'Response:{"Apple Juice Response"}'</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Response'</span>, <span class="st">'[:]'</span>, <span class="st">'[{]'</span>, <span class="st">'["]'</span>, <span class="st">'[}]'</span><span class="op">)</span>, </span>
<span>                        collapse<span class="op">=</span><span class="st">'|'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Apple Juice "</span></span></code></pre></div>
<p>If we removed things as we had been before, we’d lose part of their response! Instead, we can just remove the <em>first</em> instance of a string by using <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code></p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">'Response:{"Apple Juice Response"}'</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'[:]'</span>, <span class="st">'[{]'</span>, <span class="st">'["]'</span>, <span class="st">'[}]'</span><span class="op">)</span>, </span>
<span>                            collapse<span class="op">=</span><span class="st">'|'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "ResponseApple Juice Response"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Response"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Apple Juice Response"</span></span></code></pre></div>
<div class="rmdimportant">
<p><strong>This first gets rid of all the other text strings that are to be removed by using <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all()</a></code> as before. Then, to deal with the extra “Response”, <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> is used, and only the first instance is removed.</strong></p>
</div>
</div>
<div id="replace-parts-of-a-response" class="section level2" number="16.5">
<h2>
<span class="header-section-number">16.5</span> Replace Parts of a Response<a class="anchor" aria-label="anchor" href="#replace-parts-of-a-response"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes you will not want to only <strong>remove</strong> part of a response but also <strong>replace</strong> it with something else. Whereas the <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> function will simply remove the string, <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> will substitute it with something else that you specify!</p>
<p><code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> takes the form:<br><code>gsub(string to replace, what to replace with, where to look)</code></p>
<div class="sourceCode" id="cb345"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="st">"foo:bar"</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">":"</span><span class="op">)</span> <span class="co"># Not what you want</span></span>
<span><span class="co">#&gt; [1] "foobar"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">":"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span> <span class="co"># What you want!</span></span>
<span><span class="co">#&gt; [1] "foo bar"</span></span></code></pre></div>
<!-- ## Replace NAs without removing **all** observations: -->
<!-- You [previously](#NAs) saw how `na.omit()` and `drop_na()` could be used to remove observations containing an `NA` value. However, sometimes you may not want to remove the **entire** observation if one of its variables contains an `NA` value. You may instead want to just *replace* that value. This can be done with `replace()`. -->
<!-- ```{r} -->
<!-- penguins %>% -->
<!--   #mutate(sex = replace(.$sex, is.na(.$sex), "")) -->
<!--   replace(.$sex, is.na(.$sex), "") %>% -->
<!--   select(starts_with("DAYS")) %>% -->
<!--   head() -->
<!-- ``` -->

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="summarizing-data.html"><span class="header-section-number">15</span> Summarizing Data</a></div>
<div class="next"><a href="data-transformation.html"><span class="header-section-number">17</span> Data Transformation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#text-cleaning"><span class="header-section-number">16</span> Text Cleaning</a></li>
<li><a class="nav-link" href="#remove-text-from-strings"><span class="header-section-number">16.1</span> Remove Text From Strings</a></li>
<li><a class="nav-link" href="#escaping-special-characters"><span class="header-section-number">16.2</span> Escaping Special Characters</a></li>
<li><a class="nav-link" href="#removing-multiple-strings-at-once"><span class="header-section-number">16.3</span> Removing Multiple Strings at Once</a></li>
<li><a class="nav-link" href="#removing-the-first-instance"><span class="header-section-number">16.4</span> Removing the First Instance</a></li>
<li><a class="nav-link" href="#replace-parts-of-a-response"><span class="header-section-number">16.5</span> Replace Parts of a Response</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introduction to R</strong>" was written by Ethan Hurwitz. It was last built on 2023-11-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
