<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Data Transformation | Introduction to R</title>
<meta name="author" content="Ethan Hurwitz">
<meta name="description" content="library(tidyverse) # Load tidyverse packages Up to this point you have been working with data that, while sometimes needed cleaning, was already in tidy format. While you want to work with tidy...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 17 Data Transformation | Introduction to R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ethanhurwitz.github.io/intro-to-r/data-transformation.html">
<meta property="og:description" content="library(tidyverse) # Load tidyverse packages Up to this point you have been working with data that, while sometimes needed cleaning, was already in tidy format. While you want to work with tidy...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 17 Data Transformation | Introduction to R">
<meta name="twitter:description" content="library(tidyverse) # Load tidyverse packages Up to this point you have been working with data that, while sometimes needed cleaning, was already in tidy format. While you want to work with tidy...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Introduction to R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Background</a></li>
<li class="book-part">R Basics</li>
<li><a class="" href="why-use-r.html"><span class="header-section-number">2</span> Why use R?</a></li>
<li><a class="" href="r-coding-basics.html"><span class="header-section-number">3</span> R Coding Basics</a></li>
<li><a class="" href="using-r-effectively.html"><span class="header-section-number">4</span> Using R Effectively</a></li>
<li><a class="" href="projects-and-organization.html"><span class="header-section-number">5</span> Projects and Organization</a></li>
<li class="book-part">Visualizations</li>
<li><a class="" href="intro-to-ggplot2.html"><span class="header-section-number">6</span> Intro to ggplot2</a></li>
<li><a class="" href="aesthetics.html"><span class="header-section-number">7</span> Aesthetics</a></li>
<li><a class="" href="different-geoms-and-when-to-use-them.html"><span class="header-section-number">8</span> Different Geoms and When To Use Them</a></li>
<li><a class="" href="customization.html"><span class="header-section-number">9</span> Customization</a></li>
<li><a class="" href="color-theory.html"><span class="header-section-number">10</span> Color Theory</a></li>
<li class="book-part">Data Manipulation</li>
<li><a class="" href="control-flow.html"><span class="header-section-number">11</span> Control Flow</a></li>
<li><a class="" href="tidy-data-and-tidyverse.html"><span class="header-section-number">12</span> Tidy Data and Tidyverse</a></li>
<li><a class="" href="basic-wrangling.html"><span class="header-section-number">13</span> Basic Wrangling</a></li>
<li><a class="" href="advanced-wrangling.html"><span class="header-section-number">14</span> Advanced Wrangling</a></li>
<li><a class="" href="summarizing-data.html"><span class="header-section-number">15</span> Summarizing Data</a></li>
<li><a class="" href="text-cleaning.html"><span class="header-section-number">16</span> Text Cleaning</a></li>
<li><a class="active" href="data-transformation.html"><span class="header-section-number">17</span> Data Transformation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-transformation" class="section level1">
<h1>
<span class="header-section-number">17</span> Data Transformation<a class="anchor" aria-label="anchor" href="#data-transformation"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> <span class="co"># Load tidyverse packages</span></span></code></pre></div>
<!-- <a href="exercises/Exercise_Transformation.Rmd" download>Exercise Sheet</a> -->
<p>Up to this point you have been working with data that, while sometimes needed cleaning, was already in <a href="tidy-data-and-tidyverse.html#Tidy-Data">tidy</a> format. While you want to work with tidy data, it is not always the case that the data you get will be tidy! Also, sometimes you will need to make data <em>not</em> tidy for certain statistical analyses. Further, your data may not even all be in a singular object, and may be contained across several! This section is going to cover the most common data transformations you will have to implement.</p>
<div id="pivots" class="section level2">
<h2>
<span class="header-section-number">17.1</span> Pivots<a class="anchor" aria-label="anchor" href="#pivots"><i class="fas fa-link"></i></a>
</h2>
<p>If your data does happen to all be in the same object, how can you reshape the structure that data? The two main functions to do this are <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>.</p>
<img src="figures/tidyr_pivots.png" style="width:100.0%"><p style="font-size:6pt">
Artwork by <span class="citation">Horst (2022)</span> (with slight modification)
</p>
<div id="pivot_longer" class="section level3">
<h3>
<span class="header-section-number">17.1.1</span> pivot_longer()<a class="anchor" aria-label="anchor" href="#pivot_longer"><i class="fas fa-link"></i></a>
</h3>
<p>From the <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">source documents</a>:<br></p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> “lengthens” data, increasing the number of rows and decreasing the number of columns.</p>
<p>This is accomplished by collapsing multiple columns into new columns (usually one with the old column names and one with the cell values). You specify the specific <strong>col</strong>umn<strong>s</strong> you want to collapse, what the new column for the <strong>names</strong> should be named, and what the new column for the <strong>values</strong> should be named.</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> calls take the following form: <code>pivot_longer(cols, names_to, values_to)</code>. There are other arguments that can be used as well to help make the function even more flexible / powerful.</p>
<p>Consider the following df with data from contestants on a baking show (where they had to guess a spice from a blind taste test):</p>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bakers</span></span>
<span><span class="co">#&gt; # A tibble: 4 x 4</span></span>
<span><span class="co">#&gt;   baker  cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma            1          0        1</span></span>
<span><span class="co">#&gt; 2 Harry           1          1        1</span></span>
<span><span class="co">#&gt; 3 Ruby            1          0        1</span></span>
<span><span class="co">#&gt; 4 Zainab          0         NA        0</span></span></code></pre></div>
<p>Each row contains 3 unique observations (there just happens to be multiple measurements from the same participants). Observe how <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> can transform this df so that each row is a unique observation:</p>
<!-- ```{r} -->
<!-- bakers %>%  -->
<!--   pivot_longer(cinnamon_1:nutmeg_3, -->
<!--                names_to = "spice",  -->
<!--                values_to = "correct" -->
<!--                ) -->
<!-- #' split the current column names into two columns using names_to + names_sep -->
<!-- bakers %>%  -->
<!--   pivot_longer(-baker, -->
<!--                names_to = c("spice", "order"),  -->
<!--                names_sep = "_", -->
<!--                values_to = "correct" -->
<!--                )  -->
<!-- ``` -->
<img src="figures/pivot_longer_EH.png" style="width:100.0%"><p style="font-size:6pt">
Modified from <a href="https://github.com/apreshill/teachthat/tree/master/pivot">teachthat</a>
</p>
<img src="figures/pivot_longer_EH.gif" style="width:100.0%"><p style="font-size:6pt">
Modified from <a href="https://github.com/apreshill/teachthat/tree/master/pivot">teachthat</a>
</p>
<p class="text-info">
<strong><u>Note:</u> When specifying the columns to pivot, you are literally <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>’ing them. Thus, regular <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> rules and helper functions can be used! e.g., Here, all columns except <code>baker</code> should be pivoted, <code>!baker</code> could have been written instead of <code>cinnamon_1:nutmeg_3</code>. Likewise, <code>matches("[[:digit:]]")</code>, since all columns have a number.</strong>
</p>
<!-- <br> -->
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 1**</div> -->
<!--   <div class="panel-body"> -->
<!-- Use `pivot_longer()` to transform the data found in `tidyr::table4a` (`table4a`). -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="pivot_wider" class="section level3">
<h3>
<span class="header-section-number">17.1.2</span> pivot_wider()<a class="anchor" aria-label="anchor" href="#pivot_wider"><i class="fas fa-link"></i></a>
</h3>
<p>From the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">source documents</a>:<br></p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> “widens” data, increasing the number of columns and decreasing the number of rows.</p>
<p>This is accomplished by spreading the unique values of each cell in a column into their own new column. You specify where the new column <strong>names</strong> are <em>from</em> and where the <strong>values</strong> for those new columns are <strong>from</strong>.</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> calls take the following form: <code>pivot_wider(names_from, values_from)</code>. <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> is the opposite of <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code>. Thus, the pivoted df from above can be returned to its original form by using <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code>.</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bakers_long</span> <span class="op">=</span> <span class="va">bakers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">cinnamon_1</span><span class="op">:</span><span class="va">nutmeg_3</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"spice"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"correct"</span></span>
<span>               <span class="op">)</span></span>
<span><span class="va">bakers_long</span></span>
<span><span class="co">#&gt; # A tibble: 12 x 3</span></span>
<span><span class="co">#&gt;    baker  spice      correct</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Emma   cinnamon_1       1</span></span>
<span><span class="co">#&gt;  2 Emma   cardamom_2       0</span></span>
<span><span class="co">#&gt;  3 Emma   nutmeg_3         1</span></span>
<span><span class="co">#&gt;  4 Harry  cinnamon_1       1</span></span>
<span><span class="co">#&gt;  5 Harry  cardamom_2       1</span></span>
<span><span class="co">#&gt;  6 Harry  nutmeg_3         1</span></span>
<span><span class="co">#&gt;  7 Ruby   cinnamon_1       1</span></span>
<span><span class="co">#&gt;  8 Ruby   cardamom_2       0</span></span>
<span><span class="co">#&gt;  9 Ruby   nutmeg_3         1</span></span>
<span><span class="co">#&gt; 10 Zainab cinnamon_1       0</span></span>
<span><span class="co">#&gt; 11 Zainab cardamom_2      NA</span></span>
<span><span class="co">#&gt; 12 Zainab nutmeg_3         0</span></span></code></pre></div>
<img src="figures/pivot_wider_EH.png" style="width:100.0%"><p style="font-size:6pt">
Modified from <a href="https://github.com/apreshill/teachthat/tree/master/pivot">teachthat</a>
</p>
<img src="figures/pivot_wider_EH.gif" style="width:100.0%"><p style="font-size:6pt">
Modified from <a href="https://github.com/apreshill/teachthat/tree/master/pivot">teachthat</a>
</p>
<p>To verify this is true:</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bakers_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">spice</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">correct</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 x 4</span></span>
<span><span class="co">#&gt;   baker  cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma            1          0        1</span></span>
<span><span class="co">#&gt; 2 Harry           1          1        1</span></span>
<span><span class="co">#&gt; 3 Ruby            1          0        1</span></span>
<span><span class="co">#&gt; 4 Zainab          0         NA        0</span></span>
<span><span class="va">bakers</span> <span class="co"># Original df</span></span>
<span><span class="co">#&gt; # A tibble: 4 x 4</span></span>
<span><span class="co">#&gt;   baker  cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma            1          0        1</span></span>
<span><span class="co">#&gt; 2 Harry           1          1        1</span></span>
<span><span class="co">#&gt; 3 Ruby            1          0        1</span></span>
<span><span class="co">#&gt; 4 Zainab          0         NA        0</span></span></code></pre></div>
<!-- <br> -->
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 2**</div> -->
<!--   <div class="panel-body"> -->
<!-- Use `pivot_wider()` to transform the data found in `table2` (specifically, the `type` column). -->
<!-- </div> -->
<!-- </div> -->
</div>
</div>
<div id="relational-data" class="section level2">
<h2>
<span class="header-section-number">17.2</span> Relational Data<a class="anchor" aria-label="anchor" href="#relational-data"><i class="fas fa-link"></i></a>
</h2>
<p>In simple cases, the data needed to answer questions of interest will all be in a single object (df, table, etc.). At scale, you will often by working with data spread across a number of separate objects. Processes that involve working with data in multiple objects are referred to as <strong>relational data</strong>, as it is the relationship between that data which is important.</p>
<div id="bind_rows" class="section level3">
<h3>
<span class="header-section-number">17.2.1</span> <code>bind_rows()</code><a class="anchor" aria-label="anchor" href="#bind_rows"><i class="fas fa-link"></i></a>
</h3>
<p>Imagine you get a new set of data from contestants on the second day of the show:</p>
<div class="sourceCode" id="cb351"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bakers2</span></span>
<span><span class="co">#&gt; # A tibble: 4 x 4</span></span>
<span><span class="co">#&gt;   baker   cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Lamar            0          0        1</span></span>
<span><span class="co">#&gt; 2 Natalia          1          1        1</span></span>
<span><span class="co">#&gt; 3 Mark             1          0       NA</span></span>
<span><span class="co">#&gt; 4 Diana            1          1        0</span></span></code></pre></div>
<p>It has the exact same form as the data in <code>bakers</code> (before any transformations). To be able to work with all the data together, you’d just need to append <code>bakers2</code> to the end of <code>bakers</code>. This is precisely what <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> does! It will <em>bind</em> all the <em>rows</em> of the objects passed to it. Columns in each object will automatically be matched by their names, so it is critical that the common column names are identical!</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">bakers</span>, <span class="va">bakers2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 x 4</span></span>
<span><span class="co">#&gt;   baker   cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma             1          0        1</span></span>
<span><span class="co">#&gt; 2 Harry            1          1        1</span></span>
<span><span class="co">#&gt; 3 Ruby             1          0        1</span></span>
<span><span class="co">#&gt; 4 Zainab           0         NA        0</span></span>
<span><span class="co">#&gt; 5 Lamar            0          0        1</span></span>
<span><span class="co">#&gt; 6 Natalia          1          1        1</span></span>
<span><span class="co">#&gt; 7 Mark             1          0       NA</span></span>
<span><span class="co">#&gt; 8 Diana            1          1        0</span></span></code></pre></div>
<p>Viola!</p>
<p>If one object contains columns the other does not, those values will be filled with <code>NA</code>. In this way, <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> is very flexible as it can accommodate situations where the dfs may contain different data.</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bakers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="st">"cumin_4"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">bakers2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span><span class="co">#&gt;   baker   cinnamon_1 cardamom_2 nutmeg_3 cumin_4</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma             1          0        1       1</span></span>
<span><span class="co">#&gt; 2 Harry            1          1        1       1</span></span>
<span><span class="co">#&gt; 3 Ruby             1          0        1       0</span></span>
<span><span class="co">#&gt; 4 Zainab           0         NA        0       0</span></span>
<span><span class="co">#&gt; 5 Lamar            0          0        1      NA</span></span>
<span><span class="co">#&gt; 6 Natalia          1          1        1      NA</span></span>
<span><span class="co">#&gt; 7 Mark             1          0       NA      NA</span></span>
<span><span class="co">#&gt; 8 Diana            1          1        0      NA</span></span></code></pre></div>
<div class="rmdimportant">
<p><strong>This code used <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to add a new column to <code>bakers</code> that did not exist in <code>bakers2</code>. This new, modified, version of <code>bakers</code> was then piped to a <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> call that contained <code>bakers2</code> as an argument. This binds the rows of the new, modified, <code>bakers</code> with <code>bakers2</code>. As you can see, all the rows from <code>bakers2</code> have <code>NA</code> values in this new column, because it did not exist in the original df!</strong></p>
</div>
<!-- <div class="panel panel-success"> -->
<!-- <div class="panel-heading">**EXERCISE 3**</div> -->
<!-- <div class="panel-body"> -->
<!-- 1. Use `bind_rows()` to combine the `penguins1` and `penguins2` dfs.<br> -->
<!-- 2. Then, pipe that result to combine with `penguins3`. -->
<!-- </div> -->
<!-- </div> -->
<!-- ### bind_cols() -->
<!-- When column-binding, rows are matched by position, so all data frames must have the same number of rows. -->
<!-- ```{r} -->
<!-- bakers %>%  -->
<!--   select(c(1:3)) %>% -->
<!--   bind_cols(bakers[,c(1,4)]) -->
<!-- # bakers %>% -->
<!-- #   select(1, 4) -->
<!-- ``` -->
<!-- To match by value, not position, see mutate-joins. -->
<p>However, you likely will not always get so lucky and your individual dfs may not have identical columns. In such instances, your aim is to combine the individual dfs (<code>x</code> and <code>y</code>) into a single df that you can use in your visualizations and summaries. Specifically, you will need to make sure that, even if they appear in different orders, the observations from <code>x</code> are matched to the corresponding observation in <code>y</code> (usually by the values of some ID columns appearing in both).</p>
<p>There are a series of specific relational data functions in R designed to help with exactly this process. Below, two will be covered: <strong>mutating joins</strong> and <strong>set operations</strong>.</p>
</div>
</div>
<div id="mutating-joins" class="section level2">
<h2>
<span class="header-section-number">17.3</span> Mutating Joins<a class="anchor" aria-label="anchor" href="#mutating-joins"><i class="fas fa-link"></i></a>
</h2>
<p>Mutating Joins are named as such because, like <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, they add new columns to a dataframe. These new columns just happen to come from another another dataframe with matched observations. There are several types of mutate joins, which all result in different new data structures.</p>
<div id="inner_join" class="section level3">
<h3>
<span class="header-section-number">17.3.1</span> inner_join()<a class="anchor" aria-label="anchor" href="#inner_join"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> will return a df containing all observations (rows) in <code>x</code> that have a matched observation in <code>y</code>, for all columns in <code>x</code> and <code>y</code>. Any observations in <code>x</code> or <code>y</code> that do not have a matched in the other dataset are dropped.</p>
<img src="figures/inner_join.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 4**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `x` and `y`, write some code that will return a new df that contains only the observations common in both. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="left_join" class="section level3">
<h3>
<span class="header-section-number">17.3.2</span> left_join()<a class="anchor" aria-label="anchor" href="#left_join"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> will return a df containing all observations (rows) in <code>x</code> and all columns from <code>x</code> and <code>y</code>. Any observation (row) in <code>y</code> that does not have a match in <code>x</code> will be dropped, and any observations (rows) in <code>x</code> that do not have a match in <code>y</code> will have an <code>NA</code> value in the new column.</p>
<img src="figures/left_join.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 5**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `x` and `y`, write some code that will return a new df that contains all variables across both dfs, but only from observations in `x`. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="right_join" class="section level3">
<h3>
<span class="header-section-number">17.3.3</span> right_join()<a class="anchor" aria-label="anchor" href="#right_join"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> is basically the same as <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> except swap <code>x</code> with <code>y</code>.</p>
<img src="figures/right_join.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 6**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `x` and `y`, write some code that will return a new df that contains all variables across both dfs, but only from observations in `y`. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="full_join" class="section level3">
<h3>
<span class="header-section-number">17.3.4</span> full_join()<a class="anchor" aria-label="anchor" href="#full_join"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> will return a df containing all observations (rows) from both <code>x</code> and <code>y</code> regardless of whether or not they have matches. In the cases where there are is not a corresponding observation, an <code>NA</code> value will be generated in the new cell. <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> is the only mutate join that will contain all the original data from both <code>x</code> and <code>y</code> in the new df.</p>
<img src="figures/full_join.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 7**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `x` and `y`, write some code that will return a new df that contains all variables and observations from both dfs. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="join-summary" class="section level3">
<h3>
<span class="header-section-number">17.3.5</span> Join Summary<a class="anchor" aria-label="anchor" href="#join-summary"><i class="fas fa-link"></i></a>
</h3>
<p>Below is an oversimplified but handy graphic to illustrate what the different mutate joins return from <code>x</code> and <code>y</code>.</p>
<img src="figures/joins.png" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://r4ds.had.co.nz/relational-data.html#relational-data">r4ds</a>
</p>
</div>
</div>
<div id="set-operators" class="section level2">
<h2>
<span class="header-section-number">17.4</span> Set operators<a class="anchor" aria-label="anchor" href="#set-operators"><i class="fas fa-link"></i></a>
</h2>
<p>Set operations, like <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> expect both <code>x</code> and <code>y</code> to have the same variables. They are a quick and easy way to filter for different <em>sets</em> of observations.</p>
<p>For example, you have just been given some new data (<code>bakers3</code>) containing information about the contestants on an all-star version of this baking show. It contains winners from previous episodes, and you want to compare these contestants to the contestant data you have from the previous two episodes.</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bakers_combined</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">bakers</span>, <span class="va">bakers2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bakers3</span></span>
<span><span class="co">#&gt; # A tibble: 4 x 4</span></span>
<span><span class="co">#&gt;   baker   cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma             1          0        1</span></span>
<span><span class="co">#&gt; 2 Jack             0          0        1</span></span>
<span><span class="co">#&gt; 3 Donna            1         NA       NA</span></span>
<span><span class="co">#&gt; 4 Natalia          1          1        1</span></span></code></pre></div>
<div id="union" class="section level3">
<h3>
<span class="header-section-number">17.4.1</span> union()<a class="anchor" aria-label="anchor" href="#union"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">union()</a></code> returns a df containing all the unique observations (rows) in <code>x</code> and <code>y</code>. This will drop repeats so there is only a single entry for each unique observation.</p>
<img src="figures/union.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">union</a></span><span class="op">(</span><span class="va">bakers_combined</span>, <span class="va">bakers3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 10 x 4</span></span>
<span><span class="co">#&gt;    baker   cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Emma             1          0        1</span></span>
<span><span class="co">#&gt;  2 Harry            1          1        1</span></span>
<span><span class="co">#&gt;  3 Ruby             1          0        1</span></span>
<span><span class="co">#&gt;  4 Zainab           0         NA        0</span></span>
<span><span class="co">#&gt;  5 Lamar            0          0        1</span></span>
<span><span class="co">#&gt;  6 Natalia          1          1        1</span></span>
<span><span class="co">#&gt;  7 Mark             1          0       NA</span></span>
<span><span class="co">#&gt;  8 Diana            1          1        0</span></span>
<span><span class="co">#&gt;  9 Jack             0          0        1</span></span>
<span><span class="co">#&gt; 10 Donna            1         NA       NA</span></span></code></pre></div>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 8**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `penguins_set1` and `penguins_set2`, write some code that will return a new df that contains all unique observations from both samples. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="intersect" class="section level3">
<h3>
<span class="header-section-number">17.4.2</span> intersect()<a class="anchor" aria-label="anchor" href="#intersect"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">intersect()</a></code> will return a df containing only the observations (rows) that are in <strong>both</strong> <code>x</code> AND <code>y</code>, and only include unique values (no duplicates).</p>
<img src="figures/intersect.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">intersect</a></span><span class="op">(</span><span class="va">bakers_combined</span>, <span class="va">bakers3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 x 4</span></span>
<span><span class="co">#&gt;   baker   cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Emma             1          0        1</span></span>
<span><span class="co">#&gt; 2 Natalia          1          1        1</span></span></code></pre></div>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 9**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `penguins_set1` and `penguins_set2`, write some code that will return a new df that contains only the observations that appeared in both samples. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="setdiff" class="section level3">
<h3>
<span class="header-section-number">17.4.3</span> setdiff()<a class="anchor" aria-label="anchor" href="#setdiff"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">setdiff()</a></code> will return a df containing only the observations (rows) in <code>x</code> that <strong>do NOT</strong> appear in <code>y</code>.</p>
<img src="figures/setdiff.gif" style="width:100.0%"><p style="font-size:6pt">
Source: <a href="https://github.com/gadenbuie/tidyexplain">tidyexplain</a>
</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">bakers_combined</span>, <span class="va">bakers3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span><span class="co">#&gt;   baker  cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Harry           1          1        1</span></span>
<span><span class="co">#&gt; 2 Ruby            1          0        1</span></span>
<span><span class="co">#&gt; 3 Zainab          0         NA        0</span></span>
<span><span class="co">#&gt; 4 Lamar           0          0        1</span></span>
<span><span class="co">#&gt; 5 Mark            1          0       NA</span></span>
<span><span class="co">#&gt; 6 Diana           1          1        0</span></span></code></pre></div>
<p>While the order of <code>x</code> and <code>y</code> does not matter for <code><a href="https://generics.r-lib.org/reference/setops.html">union()</a></code> and <code><a href="https://generics.r-lib.org/reference/setops.html">intersect()</a></code>, it <em>does</em> for <code><a href="https://generics.r-lib.org/reference/setops.html">setdiff()</a></code>. Compare the output above to the output below!</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="va">bakers3</span>, <span class="va">bakers_combined</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 x 4</span></span>
<span><span class="co">#&gt;   baker cinnamon_1 cardamom_2 nutmeg_3</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Jack           0          0        1</span></span>
<span><span class="co">#&gt; 2 Donna          1         NA       NA</span></span></code></pre></div>
<!-- <div class="panel panel-success"> -->
<!--   <div class="panel-heading">**EXERCISE 10**</div> -->
<!--   <div class="panel-body"> -->
<!-- Using dfs `penguins_set1` and `penguins_set2`, write some code that will return a new df that contains only the unique observations in `penguins_set1`. -->
<!-- </div> -->
<!-- </div> -->
</div>
<div id="summary-1" class="section level3">
<h3>
<span class="header-section-number">17.4.4</span> Summary<a class="anchor" aria-label="anchor" href="#summary-1"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-figure"><img src="figures/set_operations.png" style="width:100.0%"></div>
<!-- ```{r join_practice} -->
<!-- x = tribble( -->
<!--   ~ "name", ~"age", ~"total", ~"fan_rating", -->
<!--   "Natalia", 22, 28, 4.75, -->
<!--   "Emma", 33, 27, 4.5, -->
<!--   "Jack", 37, NA, NA, -->
<!--   "Donna", 42, 24, 3.25, -->
<!--   "Zheng", 26, 25, 3.75 -->
<!--   ) -->
<!-- y = tribble( -->
<!--   ~ "name", ~"age", ~"total", ~"judge_average", -->
<!--   "Emma", 33, 27, 9.25, -->
<!--   "Jack", 37, NA, NA, -->
<!--   "Donna", 42, 24, 7.5, -->
<!--   "Natalia", 22, 28, 9.5, -->
<!--   "Carla", 29, 26, 8.25 -->
<!--   ) -->
<!-- ``` -->
</div>
</div>
<div id="extra-resources-4" class="section level2">
<h2>
<span class="header-section-number">17.5</span> Extra Resources<a class="anchor" aria-label="anchor" href="#extra-resources-4"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://tidyr.tidyverse.org/articles/pivot.html">pivoting vignette</a></li>
<li><a href="https://github.com/gadenbuie/tidyexplain">tidyexplain animated illustrations</a></li>
<li><a href="https://r4ds.had.co.nz/relational-data.html#relational-data">r4ds relational data</a></li>
<li><a href="https://rstudio-education.github.io/tidyverse-cookbook/transform-tables.html#joins">more relational data</a></li>
</ul>
</div>
<div id="references-4" class="section level2">
<h2>
<span class="header-section-number">17.6</span> References<a class="anchor" aria-label="anchor" href="#references-4"><i class="fas fa-link"></i></a>
</h2>

<div id="refs" class="references">
<div id="ref-allison_horst">
<p>Horst, A. (2022). <a href="https://github.com/allisonhorst/stats-illustrations/">https://github.com/allisonhorst/stats-illustrations/</a></p>
</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="text-cleaning.html"><span class="header-section-number">16</span> Text Cleaning</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-transformation"><span class="header-section-number">17</span> Data Transformation</a></li>
<li>
<a class="nav-link" href="#pivots"><span class="header-section-number">17.1</span> Pivots</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pivot_longer"><span class="header-section-number">17.1.1</span> pivot_longer()</a></li>
<li><a class="nav-link" href="#pivot_wider"><span class="header-section-number">17.1.2</span> pivot_wider()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#relational-data"><span class="header-section-number">17.2</span> Relational Data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#bind_rows"><span class="header-section-number">17.2.1</span> bind_rows()</a></li></ul>
</li>
<li>
<a class="nav-link" href="#mutating-joins"><span class="header-section-number">17.3</span> Mutating Joins</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inner_join"><span class="header-section-number">17.3.1</span> inner_join()</a></li>
<li><a class="nav-link" href="#left_join"><span class="header-section-number">17.3.2</span> left_join()</a></li>
<li><a class="nav-link" href="#right_join"><span class="header-section-number">17.3.3</span> right_join()</a></li>
<li><a class="nav-link" href="#full_join"><span class="header-section-number">17.3.4</span> full_join()</a></li>
<li><a class="nav-link" href="#join-summary"><span class="header-section-number">17.3.5</span> Join Summary</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#set-operators"><span class="header-section-number">17.4</span> Set operators</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#union"><span class="header-section-number">17.4.1</span> union()</a></li>
<li><a class="nav-link" href="#intersect"><span class="header-section-number">17.4.2</span> intersect()</a></li>
<li><a class="nav-link" href="#setdiff"><span class="header-section-number">17.4.3</span> setdiff()</a></li>
<li><a class="nav-link" href="#summary-1"><span class="header-section-number">17.4.4</span> Summary</a></li>
</ul>
</li>
<li><a class="nav-link" href="#extra-resources-4"><span class="header-section-number">17.5</span> Extra Resources</a></li>
<li><a class="nav-link" href="#references-4"><span class="header-section-number">17.6</span> References</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Introduction to R</strong>" was written by Ethan Hurwitz. It was last built on 2022-07-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
